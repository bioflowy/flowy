# ワークフロー実行のための実装計画

## 調査結果概要
ワークフロー実行に必要な基本インフラは実装済みですが、いくつかの重要な機能が未実装または不完全です。

## 実装が必要な項目（優先度順）

### 1. **標準ライブラリ関数の拡充** 🔧
- **現状**: 基本的な算術・比較・論理演算子は実装済み
- **課題**: WDLで必要な重要関数が未実装
- **実装必要**:
  - 正規表現サポート (`sub`関数の`TODO: Add regex support` at stdlib/mod.rs:570)
  - ファイル操作関数群
  - 型変換関数
  - 配列・文字列操作の高度な機能

### 2. **インポート解決システム** 📂
- **現状**: `ImportDoc`構造体は定義済み、`doc: Option<Box<Document>>`フィールド有り
- **課題**: インポート解決の実装が完全に欠けている
- **実装必要**:
  - URIからWDLファイルの読み込み
  - 循環依存の検出
  - 名前空間とエイリアスの解決
  - インポートされたタスクとワークフローの統合

### 3. **Scatter出力集約の実装** ⚡
- **現状**: scatter処理の基本構造は存在、`TODO: Aggregate scatter outputs properly` at workflow.rs:350
- **課題**: scatter結果の配列化が未実装（現在は最後の結果のみ使用）
- **実装必要**:
  - 各scatter反復結果の配列への集約
  - ネストされたscatterの正しい処理
  - 出力型の動的配列化

### 4. **リソース制限システム** 🛡️
- **現状**: 設定構造体とプレースホルダーのみ存在
- **課題**: `TODO: Implement actual resource limiting using cgroups or similar` at task_context.rs:212
- **実装必要**:
  - cgroups/systemdを使用したメモリ制限
  - CPU制限の実装
  - ディスク使用量監視
  - タイムアウト処理の改善

### 5. **コンテナ実行サポート** 🐳
- **現状**: 設定構造体は完備、`ContainerBackend`列挙型定義済み
- **課題**: 実際のコンテナ実行が未実装
- **実装必要**:
  - Docker APIとの統合
  - イメージ管理とプル処理
  - ボリュームマウント機能
  - コンテナ内でのコマンド実行

## 実装アプローチ

### フェーズ1: 標準ライブラリ拡張
1. 正規表現サポート追加
2. ファイル操作関数実装
3. 型変換関数完成

### フェーズ2: インポートシステム
1. ファイル読み込み機能
2. 依存関係解析
3. 名前空間統合

### フェーズ3: Scatter機能完成
1. 出力集約ロジック実装
2. ネストされたscatterサポート
3. 型システム統合

### フェーズ4: 実行環境強化
1. リソース制限実装
2. コンテナサポート追加
3. 詳細なエラー処理

各フェーズは独立して実行可能で、段階的にワークフロー実行機能を強化していきます。